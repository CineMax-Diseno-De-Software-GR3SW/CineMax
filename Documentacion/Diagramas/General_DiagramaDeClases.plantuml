@startuml General_DiagramaDeClases
skinparam linetype ortho

package empleados {
' ============================== MODELO DE DOMINIO ==============================
package modelo {
package entidades{
class Usuario {
  - id: Long
  - nombreUsuario: String
  - correo: String
  - clave: String
  - nombreCompleto: String
  - cedula: String
  - celular: String
  - activo: boolean
  - fechaCreacion: DateTime
  - fechaUltimaModificacion: DateTime
  --
  + actualizarContacto(nuevoCorreo: String, nuevoCelular: String): void
  + actualizarRol(nuevoRol: Rol): void
  + activar(): void
  + desactivar(): void
  + verificarClave(ingresada: String): boolean
}

class Rol {
  - id: Long
  - nombre: String
  - descripcion: String
  - activo: boolean
  - permisos: Set<Permiso>

  + activar(): void
  + desactivar(): void
  + tienePermiso(permiso: Permiso): boolean
  + agregarPermiso(permiso: Permiso): void
  + removerPermiso(permiso: Permiso): void

}


 enum Permiso {
    GESTIONAR_USUARIO
    VENDER_BOLETO
    GESTIONAR_SALA
    GESTIONAR_FUNCION
    GESTIONAR_REPORTES
}
}

}

Usuario  *-- "1" Rol
Permiso "0..*" -o  Rol

' ============================== SERVICIOS / CONTROLADORES ==============================

package servicios{



 class ValidadorUsuario {
   + validarCorreo(correo: String): boolean
   + validarClave(clave: String): boolean
 }

class ServicioSesionSingleton {
  - {static} servicioSesion: servicioSesionSingleton
  - usuarioActivo: Usuario
  + {static} getInstancia()
  + iniciarSesion(nombreUsuario: String, clave: String): Usuario
  + cerrarSesion(): Usuario
  + getUsuarioActivo(): Usuario
  + estaAutenticado(): boolean
  + tienePermiso(permiso: Permiso): boolean

}



class ServicioUsuarios {
  + crearUsuario(usuario: Usuario): void
  + buscarUsuarioPorCorreo(correo: String): Usuario
  + buscarUsuarioPorNombreUsuario(nombreUsuario: String): Usuario
  + listarUsuarios(): List<Usuario>
  + activarUsuario(usuario: Usuario): void
  + desactivarUsuario(usuario: Usuario): void
  + actualizarEstado(usuario: Usuario, esstado:Boolean): void
  + actualizarRolUsuario(usuario: Usuario, rol:Rol): void

}

class ServicioPerfilUsuario {
  + puedeActualizarPerfil(usuario: Usuario, id: Long): boolean
  + cambiarClave(usuario: Usuario, antigua: String, nueva: String): boolean
  + obtenerPerfil(id: Long): Usuario
  + actualizarPerfil(usuario: Usuario, correo: String, celular: String): void
}


class ServicioRoles {
  + crearRol(rol:Rol): void
  + listarRoles(): List<Rol>
  + actualizarRol(rol: Rol): void
  + activarRol(idRol: Long): void
  + desactivarRol(idRol: Long): void
  + obtenerPermisosDelRol(idRol: Long): Set<Permiso>
'  + asignarPermisoARol(Long, permiso: Permiso): void
'  + eliminarPermisoDelRol(idRol: Long, permiso: Permiso): void
'  + obtenerRolesConPermiso(permiso: Permiso): List<Rol>
  + obtenerRolPorIdUsuario(idUsuario: Long): Rol

}

' Relaciones

}

' ============================== RELACIONES DE DEPENDENCIA NECESARIAS ==============================


ServicioUsuarios .> ValidadorUsuario
ServicioPerfilUsuario .> ValidadorUsuario

ServicioPerfilUsuario .> Usuario
ServicioUsuarios ..> Usuario

' Sesión
ServicioSesionSingleton ---> Usuario
ServicioRoles ...> Rol





package controladores {

' ================================
' ControladorGestionUsuarios
' ================================
class ControladorGestionUsuarios {
  + agregarUsuario(nombreUsuario:String, correo:String,nombreCompleto:String,cedula:String,celular:String): void
  + cambiarRolUsuario(usuario: Usuario, rol:Rol): void
  + activarUsuario(usuario: Usuario): void
  + desactivarUsuario(usuario: Usuario): void
  + listarUsuarios(): List<Modelo.Usuario>
}

' ================================
' ControladorLogin
' ================================
class ControladorLogin {
  + iniciarSesion(): boolean
}

' ================================
' ControladorPortalPrincipal
' ================================
class ControladorPortalPrincipal {
  + habilitarOpcionSiTienePermiso(permiso: Permiso):void
  + cerrarSesion(): void
}


  class ControladorPerfilUsuario {
    + actualizarPerfil(usuario: Usuario, nuevoCorreo: String, nuevoCelular: String): void
    + cambiarClave(usuario: Usuario, claveActual: String, nuevaClave: String): boolean
  }


}

' Relaciones
ControladorLogin .> ServicioSesionSingleton
ControladorPortalPrincipal .> ServicioSesionSingleton
ControladorGestionUsuarios .> ServicioUsuarios
ControladorGestionUsuarios .> ServicioRoles
ControladorPerfilUsuario ..> ServicioPerfilUsuario




}

package salas {
package modelos {

package entidades{
    class Sala {
        -id: int
        -nombre: String
        -capacidad: int
        -tipo: TipoSala
        -estado: EstadoSala
    }
   class Butaca {
   -id: int
   -idSala: int
   -fila: String
   -columna: String
   -estado: EstadoButaca
   }
   enum EstadoSala{
   DISPONIBLE,
   MANTENIMIENTO
   }
   enum EstadoButaca{
   DISPONIBLE,
   OCUPADA,
   INHABILITADA
   }
   abstract class SalaFactory{
   +crearSala(int id, String nombre, int capacidad, EstadoSala estado)
   }
   class SalaNormalFactory implements SalaFactory{
   +crearSala(int id, String nombre, int capacidad, EstadoSala estado) {
   }
   class SalaVIPFactory implements SalaFactory{
   +crearSala(int id, String nombre, int capacidad, EstadoSala estado)
   }
   enum TipoSala{
   -multiplicador: double
   NORMAL(1.00),
   VIP(1.50)
   +getMultiplicador()

   }

   }



    }

    Sala -u> TipoSala
    SalaNormalFactory -u> Sala
    SalaVIPFactory -u> Sala
    Sala -u> EstadoSala
    Sala o- Butaca
    Butaca -u> EstadoButaca
    package servicios{
    class ServicioButaca{
    +listarButacasPorSala() : List<Butaca>
    +generarButacasAutomatica() : void
    +crearButaca(Butaca butaca) : void
    +actualizarButaca(Butaca butaca) : void
    +validarDatosBasicos(Butaca butaca) : void
    +listarTodasButacas() : List<Butaca>
    +eliminarButaca(int id) : void
    }
    class ServicioSala{
    -ServicioButaca : ServicioButaca
    +crearSala(Sala sala) : void
    +obtenerSalaPorId(int id) : Sala
    +listarSalas() : List<Sala>
    +actualizarSala(Sala sala) : void
    +eliminarSala(int id) : void
    +buscarSalaPorNombre(String nombre) : List<Sala>
    }
    }
    package controladores{
    class ControladorSalas {

        -servicioSala: ServicioSala
        -salas: ObservableList<Sala>
        -servicioButaca: ServicioButaca
        -salaEnEdicion: Sala
        +initialize(): void
        +onGuardar(event: ActionEvent): void
        +onBackAction(event: ActionEvent): void
    }
    class ControladorButacas {
        -servicioSala : ServicioSala
        -servicioButaca: ServicioButaca
        -salas: ObservableList<Sala>
        -butacas: ObservableList<Butaca>
        +initialize(): void
        +onBackAction(event: ActionEvent): void
    }
    class ControladorDeConsultaSalas {
        -servicioButaca : ServicioButaca
        -butacasSeleccionadas: List<Butaca>
        -controladorAsignadorButacas: ControladorAsignadorButacas
        +initialize(location: URL, resources: ResourceBundle): void
        +mostrarButacasDeSala(codigosButacasOcupadas: Set<Integer>, salaSeleccionada: Sala): void
        +getButacasSeleccionadas(): List<Butaca>
        +setControladorAsignadorButacas(controladorAsignadorButacas: ControladorAsignadorButacas): void
    }
    }

ServicioSala -u-> ServicioButaca
ControladorButacas -u-> ServicioSala
ControladorButacas -u-> ServicioButaca
Sala -u-o ControladorButacas
Butaca -u-o ControladorButacas
ControladorSalas -u-> ServicioSala
ControladorSalas o-u- Sala
ControladorSalas -u-> ServicioButaca
ControladorDeConsultaSalas -u-> ServicioButaca
ControladorDeConsultaSalas o-u- Butaca
ControladorSalas -u-> SalaFactory
}

package peliculas {
    ' ==================== PAQUETE: MODELO ====================
    package modelos {
        package entidades{

        class Pelicula {
        - id: int
        - titulo: String
        - sinopsis: String
        - duracionMinutos: int
        - anio: int
        - idioma: Idioma
        - genero: String
        - imagenUrl: String
        + getId(): int
        + getTitulo(): String
        + getSinopsis(): String
        + getDuracionMinutos(): int
        + getAnio(): int
        + getIdioma(): Idioma
        + getGenero(): String
        + getImagenUrl(): String
        + setId(id: int): void
        + setTitulo(titulo: String): void
        + setSinopsis(sinopsis: String): void
        + setDuracionMinutos(duracionMinutos: int): void
        + setAnio(anio: int): void
        + setIdioma(idioma: Idioma): void
        + setGenero(genero: String): void
        + setImagenUrl(imagenUrl: String): void
        + setIdiomaPorCodigo(codigoIdioma: String): void
        }

        class Funcion {
            - id: int
            - pelicula: Pelicula
            - sala: Sala
            - fechaHoraInicio: LocalDateTime
            - fechaHoraFin: LocalDateTime
            - formato: FormatoFuncion
            - tipoEstreno: TipoEstreno
            + getId(): int
            + getPelicula(): Pelicula
            + getSala(): Sala
            + getFechaHoraInicio(): LocalDateTime
            + getFechaHoraFin(): LocalDateTime
            + getFormato(): FormatoFuncion
            + getTipoEstreno(): TipoEstreno
            + setId(id: int): void
            + setPelicula(pelicula: Pelicula): void
            + setSala(sala: Sala): void
            + setFechaHoraInicio(fechaHoraInicio: LocalDateTime): void
            + setFechaHoraFin(fechaHoraFin: LocalDateTime): void
            + setFormato(formato: FormatoFuncion): void
            + setTipoEstreno(tipoEstreno: TipoEstreno): void
        }

        ' class Sala {
        '     - id: int
        '     - nombre: String
        '     - capacidad: int
        '     - tipo: String
        ' }

        class Cartelera {
            - id: int
            - peliculas: List<Pelicula>
            + getId(): int
            + getPeliculas(): List<Pelicula>
            + setId(id: int): void
            + setPeliculas(peliculas: List<Pelicula>): void
        }

        enum Idioma {
            ESPANOL("Español", "es")
            INGLES("Ingles", "en")
            CHINO("Chino", "zh")
            - nombre: String {f}
            - codigo: String {f}
            + getNombre(): String
            + getCodigo(): String
            + porCodigo(codigo: String): Idioma {static}
            + porNombre(nombre: String): Idioma {static}
        }

        enum Genero {
            ACCION("Acción")
            COMEDIA("Comedia")
            DRAMA("Drama")
            TERROR("Terror")
            CIENCIA_FICCION("Ciencia Ficción")
            ANIMACION("Animación")
            - nombre: String {f}
            + getNombre(): String
            + porNombre(nombre: String): Genero {static}
            + validarGeneros(generos: String): boolean {static}
            + normalizarGeneros(generos: String): String {static}
            + obtenerTodosLosGeneros(): String {static}
        }

        enum TipoEstreno{
            ESTRENO
            PREESTRENO
        }

        enum FormatoFuncion{
            DOS_D
            TRES_D
            + fromString(value: String): FormatoFuncion {static}
        }

        }
    }

    ' ==================== PAQUETE: CONTROLADORES ====================
    package controladores {
        class ControladorPelicula {
            - servicioPelicula: ServicioPelicula
            + iniciar(): void
            - mostrarMenu(): void
            - leerOpcion(): int
            - crearNuevaPelicula(): void
            - listarTodasLasPeliculas(): void
            - buscarPeliculaPorId(): void
            - buscarPeliculasPorTitulo(): void
            - actualizarPelicula(): void
            - eliminarPelicula(): void
            - mostrarEstadisticas(): void
            - verificarDuplicados(): void
            - seleccionarIdioma(): Idioma
            - seleccionarGeneros(): String
            - mostrarDetallePelicula(pelicula: Pelicula): void
            - truncarTexto(texto: String, longitud: int): String
            - esperarEnter(): void
            + cerrar(): void
        }

        class ControladorFuncion {
            - servicioFuncion: ServicioFuncion
            - servicioPelicula: ServicioPelicula
            - servicioSala: ServicioSala
            + iniciar(): void
            - mostrarMenu(): void
            - esperarEnter(): void
            - leerOpcion(): int
            - programarNuevaFuncion(): void
            - seleccionarPelicula(): Pelicula
            - seleccionarSala(): Sala
            - seleccionarFormato(): FormatoFuncion
            - seleccionarTipoEstreno(): TipoEstreno
            - listarTodasLasFunciones(): void
            - editarFuncion(): void
            - mostrarDetalleFuncion(funcionExistente: Funcion): void
            - mostrarDetalleFuncion(): void
            - mostrarFuncionesDeSala(sala: Sala): void
            - mostrarFuncionesDeSala(): void
            - eliminarFuncion(): void
            + cerrar(): void
        }

        class ControladorCartelera {
            - servicioCartelera: ServicioCartelera
            + iniciar(): void
            - mostrarMenu(): void
            - leerOpcion(): int
            - agregarFuncionACartelera(): void
            - eliminarFuncionDeCartelera(): void
            - listarFuncionesDeCartelera(): void
            - filtrarCartelera(): void
            - mostrarDetalleFuncion(): void
            + cerrar(): void
        }
    }

    ' ==================== PAQUETE: SERVICIOS ====================
    package servicios {
        class ServicioPelicula {
        - peliculaDAO: PeliculaDAO
        + crearPelicula(titulo: String, sinopsis: String, duracionMinutos: int, anio: int, idioma: Idioma, genero: String, imagenUrl: String): Pelicula
        + actualizarPelicula(id: int, titulo: String, sinopsis: String, duracionMinutos: int, anio: int, idioma: Idioma, genero: String, imagenUrl: String): void
        + eliminarPelicula(id: int): void
        + buscarPeliculaPorId(id: int): Pelicula
        + listarTodasLasPeliculas(): List<Pelicula>
        + buscarPeliculasPorTitulo(titulo: String): List<Pelicula>
        + existePeliculaDuplicada(titulo: String, anio: int): boolean
        + obtenerEstadisticas(): String
        - validarDatosPelicula(titulo: String, sinopsis: String, duracionMinutos: int, anio: int, genero: String): void
        }

        class ServicioFuncion {
            + programarNuevaFuncion(pelicula: Pelicula, sala: Sala, fechaHoraInicio: LocalDateTime, formato: FormatoFuncion, tipoEstreno: TipoEstreno): Funcion
            - validarDatosFuncion(pelicula: Pelicula, sala: Sala, fechaHoraInicio: LocalDateTime, formato: FormatoFuncion, tipoEstreno: TipoEstreno): void
            - validarHorarioTrabajo(inicio: LocalDateTime, fin: LocalDateTime): void
            - validarTraslapeFunciones(sala: Sala, inicio: LocalDateTime, fin: LocalDateTime): void
            + editarFuncion(id: int, pelicula: Pelicula, sala: Sala, fechaHoraInicio: LocalDateTime, formato: FormatoFuncion, tipoEstreno: TipoEstreno): void
            + listarTodasLasFunciones(): List<Funcion>
            + buscarPorId(id:int): Funcion
            + listarFuncionesPorSala(salaId: int): List<Funcion>
            + eliminarFuncion(id: int): void
        }
    }

    ' ==================== RELACIONES ====================

    controladores.ControladorFuncion..> servicios.ServicioFuncion
    controladores.ControladorCartelera..> servicios.ServicioFuncion
    controladores.ControladorPelicula..> servicios.ServicioPelicula
    controladores.ControladorFuncion..> servicios.ServicioPelicula
    ControladorFuncion ..> ControladorSalas

    Funcion "1" --> "1" Pelicula : proyecta
    Funcion "1" --> "1" Sala : ocurre en
    Cartelera "1" --> "0..*" Pelicula : muestra

    ServicioFuncion ..> Funcion
    ServicioFuncion ..> Cartelera
    ServicioPelicula ..> Pelicula

    Pelicula --> Idioma
    Pelicula --> Genero

    Funcion --> FormatoFuncion
    Funcion --> TipoEstreno


}

package venta_boletos {

skinparam linetype ortho

' ------------------ CONTROLADORES ------------------

package controladores {

    class ControladorAsignadorButacas {
        - funcionSeleccionada: Funcion
        - ControladorInformacionDeVenta: ControladorInformacionDeVenta
        - controladorDeConsultaSalas: ControladorDeConsultaSalas
        - butacasSeleccionadas: List<Butaca>
        + inicializarDatos(funcionSeleccionada: Funcion): void
        - cargarMapaButacas(codigosButacasOcupadas: Set<Integer>, salaSeleccionada: Sala): void
        + agregarButacaSeleccionada(butaca: Butaca): void
        + quitarButacaDeseleccionada(butaca: Butaca): void
    }

    class ControladorFacturacion {
        - servicioFacturacion: ServicioFacturacion
        - servicioCliente: ServicioCliente
        - ControladorInformacionDeVenta: ControladorInformacionDeVenta
        - boletos: List<Producto>
        + cargarBoletosSeleccionados(boletos: List<Producto>): void
        - crearCliente(): void
        - actualizarCliente(): void
        - buscarCliente(): void
        - pagarBoletos(): void
        - validarNumeroDocumentoCliente(): boolean
        - timerLabel: Label
    }

    class ControladorInformacionDeVenta {
        - cantidadDeButacasSeleccionadas: int
        + cargarInformacionDeFuncionSeleccionada(funcion: Funcion): void
        + calcularPosibleSubtotal(butacasSeleccionadas: List<Butaca>, funcion: Funcion): void
        + calcularTotal(boletos: List<Producto>): void
        + cargarButacaSeleccionada(butaca Butaca): void
        + removerButacaSeleccionada(butaca Butaca): void
    }

    class ControladorVisualizadorCartelera {
        - servicioVisualizarCartelera: ServicioVisualizarCartelera
        - cargarCartelera(peliculas: List<Pelicula>): void
    }   

    class ControladorVisualizadorFunciones {
        - servicioVisualizadorFunciones: ServicioVisualizadorFunciones
        - peliculaSeleccionada: Pelicula
        + asignarPeliculaSeleccionada(pelicula: Pelicula): void
        - cargarInformacionPeliculaSeleccionada(pelicula: Pelicula): void
        - cargarFunciones(): void
    }
}

' ------------------ SERVICIOS ------------------
package servicios{

    class ServicioContenidoFactura {
        +generarFactura(factura: Factura): void
        +generarBoletos(boletos: List<Producto>): void
        +unirPDFsFacturaYBoletos(facturaFile: File, boletosFiles: List<File>, archivoSalida: File): void
        +generarNombreArchivoBoleto(boleto: Boleto): String
    }

    class ServicioFacturacion {
        + generarFactura(productos: List<Producto>, cliente: Cliente, calculadorImpuesto: CalculadorImpuesto): void
    }

    interface ServicioGeneradorArchivo {
        + generarFactura(factura: Factura): void
        + generarBoletos(boletos: List<Producto>): void
    }

    class ServicioGeneradorArchivoPDF implements ServicioGeneradorArchivo {
        + generar(factura: Factura): void
        + generar(boletos: List<Producto>): void
        - crearCarpetaSiNoExiste(carpeta: String): void

    }

    class ServicioGeneradorBoleto{
        + generarBoletos(funcion: Funcion, butacas: List<Butaca>): List<Boleto>
    }

    class ServicioVisualizadorCartelera {
        - controladorCartelera: ControladorCartelera
        - peliculaSeleccionada: Pelicula
        + cargarPeliculasDeCartelera(): void
        + seleccionarPelicula(pelicula: Pelicula, currentStage: Stage): void
        - validarSeleccionPelicula(pelicula: Pelicula): void
    }

    class ServicioVisualizadorFunciones {
        - controladorFunciones: ControladorFunciones
        + cargarFunciones(pelicula: Pelicula): List<Funcion>
        + seleccionarFuncion(tabla: TableView<Funcion>): void
        - validarSeleccionFuncion(funcion: Funcion): void
    }

    class ServicioCliente {
        + crearCliente(cliente: Cliente): void
        + actualizarCliente(cliente: Cliente): void
        + buscarCliente(numeroIdentificacion: String): Cliente
        + existeCliente(numeroIdentificacion: String): boolean
    }

    class ServicioTemporizador{
        - {static} instancia: ServicioTemporizador
        - temporizador: Timer
        - tempEnEjecucion: boolean
        - finTiempo: long
        - tiempoRestante: StringProperty
        --
        + {static} getInstancia(): ServicioTemporizador
        + empezarTemporizador(stage: Stage): void
        + detenerTemporizador(): void
        + tempEnEjecucion(): boolean
        + tiempoRestanteProperty(): StringProperty
    }

}

package utilidades {

    package strategyValidacionDocumentos  #lightyellow
    {

        class ContextoValidacion #lightblue {
            - estrategia: EstrategiaValidacion
            + setEstrategia(estrategia: EstrategiaValidacion): void
            + ejecutarEstrategia(documento: String): boolean
        }
        
        class EstrategiaCedulaValidacion #lightblue implements EstrategiaValidacion  {
        }
        interface EstrategiaValidacion #lightblue {
            + validar(documento: String): boolean
        }

        class EstrategiaPasaporteValidacion #lightblue implements EstrategiaValidacion {
        }

        class EstrategiaRucValidacion #lightblue extends EstrategiaCedulaValidacion {
        }
    }

    package strategyParaDocumentos {
        interface Exportable {
            +exportar(reporte: ReporteGenerado, archivo: File, datos: Map<String, Object>): void
        }

        class EstrategiaExportarPDF implements Exportable {
            +crearDocumentoPDF(): PDDocument
            +guardarPDF(document: PDDocument, archivo: File): void
        }

        class EstrategiaExportarCSV implements Exportable {

        }
    }

    class ServicioCorreoSingleton {
        - instancia: ServicioCorreoSingleton
        - remitente: String
        - clave: String
        - sesion: Session
        - transport: Transport
        - ServicioCorreoSingleton()
        + getInstancia(): ServicioCorreoSingleton
        - crearSesionSMTP(): Session
        + enviarCorreo(destinatario: String, contenido: ContenidoMensaje): boolean
        + enviarCorreo(destinatario: String, contenido: ContenidoMensaje, adjunto: File): boolean
    }
}

' ------------------ MODELOS ------------------
package modelos {

    class Boleto {
        - funcion: Funcion
        - butaca: Butaca
    }

    interface CalculadorImpuesto {
        + calcularImpuesto(subtotal: double): double
    }

    class CalculadorIVA {
        - {static} IVA_TASA: double
    }

    class Cliente {
        - idCliente: String
        - tipoDocumento: String
        - nombre: String
        - apellido: String
        - correoElectronico: String
    }

    class Factura {
        - codigoFactura: long
        - fecha: String
        - cliente: Cliente
        - productos: List<Producto>
        - subtotal: double
        - total: double
        + calcularSubTotal(): void
        + calcularTotal(calculadorImpuesto:CalculadorImpuesto): void
    }

    abstract class Producto {
        - precio: double
        + {abstract} calcularPrecio(): void
    }

}


' ------------------ RELACIONES ------------------

' Relaciones de composición y agregación (tienen instancias como atributos)
ControladorFacturacion *--> ServicioFacturacion
ControladorFacturacion *--> ServicioCliente
ControladorVisualizadorCartelera *--> ServicioVisualizadorCartelera
ControladorVisualizadorFunciones *--> ServicioVisualizadorFunciones
ControladorAsignadorButacas o--> ControladorInformacionDeVenta
ControladorFacturacion o--> ControladorInformacionDeVenta

' Relaciones de uso/dependencia (se crean o usan temporalmente)
ControladorAsignadorButacas ..> ServicioGeneradorBoleto
ControladorFacturacion ..> ContextoValidacion
ControladorFacturacion ..> CalculadorImpuesto


' Servicios que crean o usan entidades
ServicioGeneradorBoleto ..> Boleto
ServicioFacturacion ..> Factura
ServicioFacturacion ..> ServicioGeneradorArchivoPDF
ServicioFacturacion ..> ServicioContenidoFactura
ServicioContenidoFactura ..> EstrategiaExportarPDF
ServicioFacturacion ..left> Cliente

' Relaciones de herencia e implementación
Producto <|-- Boleto
CalculadorIVA ..up|> CalculadorImpuesto

' Asociaciones entre entidades
Factura "1" *-- "1..*" Producto
Factura "1" *-- "1..*" Cliente
Boleto "1" *-- "1" Funcion
Boleto "1" *-- "1" Butaca

' Patrón Strategy
ContextoValidacion o--> EstrategiaValidacion

' Uso de interfaces/clases abstractas
Factura ..> CalculadorImpuesto

ControladorReportesPrincipal --> Exportable
ServicioFacturacion ..> ServicioCorreoSingleton


}

package "Reportes"{
    ' ===== MODELO (REPORTES) =====
    package "Modelo" {

        class Reporte {
            -int idReporte
            -String tipoReporte
            -Long intervaloEjecucion
            -Date proximaEjecucion
            -String contenido
            -String formato
            -String rutaArchivo
        
            +setFormatoDeContenido()
            +guardarLocalmente(): boolean
            +generar(IGeneradorReporte): void
        }

        interface IVentas {
            +obtenertotalVentas()
            +obtenertotalBoletos()
        }
        
        class ServicioFacturacion {
        
        }
        

        class ReporteProgramado {
            -String nombre
            -String tipoReporte
            -FrecuenciaReporte frecuencia
            -Date fechaInicio
            -Date fechaFin
            -Time horaEjecucion
            -boolean activo
            ''-Date ultimaEjecucion
            ''-Date proximaEjecucion
            -String rutaAlmacenamiento
            +programarProximaEjecucion(): void
            +validarConfiguracion(): boolean
        }

        enum FrecuenciaReporte  {
            DIARIO
            SEMANAL
            MENSUAL
            ANUAL
            +calcularProximaFecha(fechaBase: Date): Date
        }
        
        class DatosGrafica {
            -label String[]
            -data: double[]
            -metricName: String
        }
        
        interface IGeneradorReporte {
        +generarFormato(reporte: Reporte): String
        }

        class GeneradorPDF implements IGeneradorReporte {
        +generarFormato(reporte: Reporte): String
        }

        class GeneradorCSV implements IGeneradorReporte {
        +generarFormato(reporte: Reporte): String
        }
        

        ServicioFacturacion .up.|> IVentas
        Reporte --> IVentas
        ReporteProgramado -left-> FrecuenciaReporte : tiene
        ReporteProgramado --|> Reporte
        Reporte -left-> IGeneradorReporte
        
        
    }

    ' ===== SERVICIOS (REPORTES) =====
    package "Servicios" {

        class ServicioReportes  {
            - datos: Map<String, Object>
            +generarReporteVentas(fechaInicio: Date, fechaFin: Date): Reporte
            +guardarReporteLocalmente(reporte: Reporte, ruta: String): boolean
            +obtenerDatosVentas(fechaInicio: Date, fechaFin: Date): Map<String, Object>
        }

        class ServicioProgramacionReportes {
            +crearReporteProgramado(r: ReporteProgramado): ReporteProgramado
            +actualizarReporteProgramado(reporteProgramado: ReporteProgramado): boolean
            +eliminarReporteProgramado(idReporte: int): boolean
            +listarReportesProgramados(): List<ReporteProgramado>
            +obtenerReportesPendientes(): List<ReporteProgramado>
            +ejecutarReporteProgramado(reporteProgramado: ReporteProgramado): boolean
            +calcularProximaEjecucion(reporteProgramado: ReporteProgramado): Date
            +verificarReportesPendientes(): void
        }

        ServicioReportes --> IVentas : obtiene_datos
        ServicioReportes --> Reporte
        ServicioProgramacionReportes -right-> ReporteProgramado
    }


    ' ===== CONTROLADOR (REPORTES) =====
    package "Controlador" {

        class ControladorReportes {
            -ReportesView vista
            -Reporte modelo
            -ServicioReportes servicio
            -ServicioProgramacionReportes servicioProgramacion
            +inicializar(): void
            +generarReporte(): void
            +mostrarReporte(): void
            +exportarReporte(formato: String): void
            +generarGrafico(): void
            +programarReporte(): void
            +editarReporteProgramado(): void
            +eliminarReporteProgramado(): void
            +cargarReportesProgramados(): void
            +ejecutarReportesPendientes(): void
        }

        ControladorReportes --> Reporte : usa
        ControladorReportes -left-> DatosGrafica: usa
        ControladorReportes --> ServicioReportes : usa
        ControladorReportes --> ServicioProgramacionReportes : usa
    }
}

' ============================== RELACIONES GENERALES ==============================
ControladorAsignadorButacas ..> ControladorDeConsultaSalas
ControladorAsignadorFuncion ..> ControladorCartelera

ControladorPortalPrincipal ..> ControladorVentaBoletos
ControladorPortalPrincipal ..> ControladorPelicula
ControladorPortalPrincipal ..> ControladorFuncion
ControladorPortalPrincipal ..> ControladorSalas
ControladorPortalPrincipal ..> ControladorButacas
ControladorPortalPrincipal ..> ControladorReportes
ControladorReportes ..> ControladorVentaBoletos 
@enduml
